<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Admin — Shoebox Dashboard</title>
<style>
    body { font-family: Arial; max-width: 900px; margin: auto; padding: 20px; }
    label { display: block; margin-top: 12px; font-weight: bold; }
    textarea, input { width: 100%; padding: 8px; margin-top: 6px; }
    button { padding: 10px 14px; margin-top: 10px; cursor: pointer; }
    .status { white-space: pre-wrap; margin-top: 12px; }
</style>
</head>

<body>
<h1>Admin — Update Shared Shoebox Dataset</h1>

<p>
Enter the admin password, edit the dataset, and save.  
This will update <code>data.json</code> in the GitHub repo  
<strong>gabrielleborces-dotcom/shoebox-of-malasakit</strong>
via the Netlify serverless function.
</p>

<label>Admin password</label>
<input id="adminPass" type="password" placeholder="Enter admin password">

<label>Departments (comma-separated)</label>
<textarea id="departments">HR, Finance, Logistics, Sales, IT, Marketing, Admin, Customer Service, Procurement, R&D</textarea>

<label>Shoebox counts (comma-separated)</label>
<textarea id="boxes">120, 95, 160, 180, 140, 100, 80, 110, 70, 90</textarea>

<label>Target</label>
<input id="target" type="number" value="1500">

<button id="preview">Preview JSON</button>
<button id="commit">Save Changes</button>

<div class="status" id="status"></div>

<script>
/* -----------------------
   Build JSON payload
------------------------ */
function buildPayload() {
  return {
    departments: document.getElementById('departments').value
      .split(',').map(s => s.trim()).filter(Boolean),

    boxes: document.getElementById('boxes').value
      .split(',').map(s => Number(s.trim()) || 0),

    target: Number(document.getElementById('target').value) || 0
  };
}

/* -----------------------
   Show preview
------------------------ */
document.getElementById('preview').addEventListener('click', () => {
  document.getElementById('status').textContent =
    JSON.stringify(buildPayload(), null, 2);
});

/* -----------------------
   Commit changes to Netlify → GitHub
------------------------ */
document.getElementById('commit').addEventListener('click', async () => {
  const adminPass = document.getElementById('adminPass').value;
  if (!adminPass)
    return alert("Enter the admin password.");

  const payload = buildPayload();
  document.getElementById('status').textContent = "Sending to Netlify function...";

  try {
    const res = await fetch('/.netlify/functions/updateData', {
      method: 'POST',
      headers: {
        "Content-Type": "application/json",
        "x-admin-password": adminPass   // REQUIRED header
      },
      body: JSON.stringify(payload)
    });

    const text = await res.text();
    document.getElementById('status').textContent = text;

  } catch (err) {
    document.getElementById('status').textContent =
      "Error: " + err.toString();
  }
});
</script>

</body>
</html>
