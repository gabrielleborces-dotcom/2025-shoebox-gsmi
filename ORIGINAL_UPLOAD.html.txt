<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ðŸŽ„ Shoebox Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Mountains+of+Christmas:wght@700&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Fredoka One', cursive;
    background: linear-gradient(#c62828, #8e0000);
    margin:0; padding:20px; color:white;
}
label { display:block; margin-top:10px; font-weight:bold; font-family: 'Fredoka One', cursive;}
textarea,input { width:100%; padding:10px; border-radius:8px; border:none; margin-top:6px; margin-bottom:15px; font-size:16px;}
button { padding:12px; border-radius:10px; border:none; cursor:pointer; font-size:18px; margin-top:10px; font-weight:bold; width:100%; background:#43a047; color:white;}
button:hover { background:#2e7d32; }
.container { max-width:1200px; margin:auto; }
</style>
</head>
<body>
<div class="container">
<h1 style="text-align:center; font-family:'Mountains of Christmas', cursive; font-size:48px;">ðŸŽ… 2025 Ginebra Shoebox Dashboard ðŸŽ„</h1>

<label>Departments:</label>
<textarea id="deptInput">HR, Finance, Logistics, Sales, IT, Marketing, Admin, Customer Service, Procurement, R&D</textarea>
<label>Shoeboxes Received:</label>
<textarea id="boxInput">120, 95, 160, 180, 140, 100, 80, 110, 70, 90</textarea>
<label>Total Target:</label>
<input id="targetInput" type="number" value="1500">
<button onclick="updateData()">Update Dashboard</button>
<button onclick="exportPNG()">ðŸ“¸ Export PNG</button>
<button onclick="exportGIF()">ðŸŽ¬ Export Animated GIF</button>

<canvas id="dashboardCanvas" width="1200" height="700" style="display:block; margin-top:20px; border:2px solid white; border-radius:15px;"></canvas>
</div>

<script>
const canvas=document.getElementById('dashboardCanvas');
const ctx=canvas.getContext('2d');

let departments=["HR","Finance","Logistics","Sales","IT","Marketing","Admin","Customer Service","Procurement","R&D"];
let boxes=[120,95,160,180,140,100,80,110,70,90];
let target=1500;

const pastelColors=["#FFB3BA","#FFDFBA","#FFFFBA","#BAFFC9","#BAE1FF","#E3BAFF","#FFCFF0","#C7F0FF"];
const icons=["ðŸŽ","ðŸŽ„","â›„","ðŸ””","ðŸ§¦","ðŸ•¯ï¸","â„ï¸","ðŸª","ðŸ§¸","ðŸ›·"];

// ---------------- Ethereal Snowflake Class ----------------
class Snowflake {
    constructor() { this.reset(); }
    reset() {
        this.x=Math.random()*canvas.width;
        this.y=Math.random()*canvas.height;
        this.size=2+Math.random()*4;
        this.speed=0.2+Math.random()*1.2;
        this.angle=Math.random()*Math.PI*2;
        this.opacity=0.2+Math.random()*0.4;
        this.rotationSpeed=0.001+Math.random()*0.002;
    }
    update() {
        this.y+=this.speed;
        this.x+=Math.sin(this.angle)*0.5;
        this.angle+=this.rotationSpeed;
        if(this.y>canvas.height || this.x<0 || this.x>canvas.width) this.reset();
    }
    draw(ctx){
        ctx.save();
        ctx.translate(this.x,this.y);
        ctx.rotate(this.angle*5);
        ctx.strokeStyle=`rgba(255,255,255,${this.opacity})`;
        ctx.lineWidth=1;
        ctx.beginPath();
        for(let i=0;i<6;i++){ ctx.moveTo(0,0); ctx.lineTo(0,this.size); ctx.rotate(Math.PI/3);}
        ctx.stroke();
        ctx.restore();
    }
}

let snowflakes=[];
for(let i=0;i<100;i++) snowflakes.push(new Snowflake());
function drawSnow(){ snowflakes.forEach(f=>{f.update();f.draw(ctx);}); }

// ---------------- Background ----------------
function drawBackground(){
    const grad=ctx.createLinearGradient(0,0,0,canvas.height);
    grad.addColorStop(0,"#c62828");
    grad.addColorStop(1,"#8e0000");
    ctx.fillStyle=grad;
    ctx.fillRect(0,0,canvas.width,canvas.height);
}

// ---------------- Department Chart (2 Rows) ----------------
function drawDepartmentChart(){
    const chartX=50, chartY=150, chartWidth=650, chartHeight=500;
    const numDeps = departments.length;
    const half = Math.ceil(numDeps/2);
    const rowHeight = chartHeight/2;
    const maxBox=Math.max(...boxes,target);

    // Add graph title above department bars
    ctx.font="28px Mountains of Christmas";
    ctx.fillStyle="white";
    ctx.textAlign="center";
    ctx.fillText("2025 Ginebra Shoebox of Malasakit Collection", chartX+chartWidth/2, chartY-40);

    ctx.font="20px Fredoka One";
    ctx.textAlign="center";

    for(let row=0; row<2; row++){
        const startIdx = row*half;
        const endIdx = Math.min(startIdx+half, numDeps);
        const yOffset = chartY + row*rowHeight;
        for(let i=startIdx;i<endIdx;i++){
            const b=boxes[i];
            const barHeight=(b/maxBox)*rowHeight;
            const barWidth = chartWidth/(endIdx-startIdx)*0.6;
            const x = chartX + (i-startIdx)*(chartWidth/(endIdx-startIdx)) + (chartWidth/(endIdx-startIdx)*0.2);
            const y = yOffset + rowHeight - barHeight;

            // Draw bar
            ctx.fillStyle=pastelColors[i % pastelColors.length];
            ctx.fillRect(x,y,barWidth,barHeight);

            // Draw value above bar
            ctx.fillStyle="white";
            ctx.fillText(b, x+barWidth/2, y-10);

            // Draw department label below the bars, diagonal
            ctx.save();
            ctx.translate(x + barWidth/2, yOffset + rowHeight + 30); // move below axis
            ctx.rotate(-Math.PI/6); // rotate 30 degrees
            ctx.fillStyle="white";
            ctx.fillText(icons[i % icons.length]+" "+departments[i], 0, 0);
            ctx.restore();
        }
    }

    // Y-axis
    ctx.strokeStyle="white";
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.moveTo(chartX,chartY);
    ctx.lineTo(chartX,chartY+chartHeight);
    ctx.stroke();
}

// ---------------- Tube ----------------
CanvasRenderingContext2D.prototype.roundRect=function(x,y,w,h,r){
    if(w<2*r) r=w/2;
    if(h<2*r) r=h/2;
    this.beginPath();
    this.moveTo(x+r,y);
    this.arcTo(x+w,y,x+w,y+h,r);
    this.arcTo(x+w,y+h,x,y+h,r);
    this.arcTo(x,y+h,x,y,r);
    this.arcTo(x,y,x+w,y,r);
    this.closePath();
    return this;
};

let tubeGradientOffset=0;
let sparkles=[];
function drawTube(){
    const tubeX=750,tubeY=150,tubeWidth=150,tubeHeight=500;
    const totalBoxes=boxes.reduce((a,b)=>a+b,0);
    const percent=Math.min(totalBoxes/target,1);
    const fillHeight=tubeHeight*percent;

    // Tube border
    ctx.beginPath();
    ctx.roundRect(tubeX,tubeY,tubeWidth,tubeHeight,75);
    ctx.strokeStyle="white";
    ctx.lineWidth=4;
    ctx.stroke();

    // Clip to tube
    ctx.save();
    ctx.beginPath();
    ctx.roundRect(tubeX,tubeY,tubeWidth,tubeHeight,75);
    ctx.clip();

    // Continuous gradient animation
    const grad=ctx.createLinearGradient(tubeX+tubeGradientOffset, tubeY+tubeHeight-fillHeight, tubeX+tubeWidth+tubeGradientOffset, tubeY+tubeHeight);
    for(let i=0;i<pastelColors.length;i++) grad.addColorStop(i/(pastelColors.length-1), pastelColors[i]);
    ctx.fillStyle=grad;
    ctx.fillRect(tubeX, tubeY+tubeHeight-fillHeight, tubeWidth, fillHeight);

    tubeGradientOffset+=0.5;
    if(tubeGradientOffset>tubeWidth) tubeGradientOffset=0;

    // Sparkles
    if(!sparkles.length){
        for(let i=0;i<25;i++){
            sparkles.push({x:Math.random()*tubeWidth, y:Math.random()*fillHeight, radius:1+Math.random()*2, alpha:Math.random()*0.6+0.3, delta:Math.random()*0.02+0.01});
        }
    }
    sparkles.forEach(s=>{
        s.alpha+=s.delta;
        if(s.alpha>1 || s.alpha<0.2) s.delta*=-1;
        ctx.fillStyle=`rgba(255,255,255,${s.alpha})`;
        ctx.beginPath();
        ctx.arc(tubeX+s.x, tubeY+tubeHeight-s.y, s.radius,0,Math.PI*2);
        ctx.fill();
    });

    ctx.restore();

    // Target line
    const targetY=tubeY+tubeHeight-(tubeHeight*target/target);
    ctx.strokeStyle="#ffeb3b";
    ctx.lineWidth=4;
    ctx.beginPath();
    ctx.moveTo(tubeX-10,targetY);
    ctx.lineTo(tubeX+tubeWidth+10,targetY);
    ctx.stroke();

    // Label
    ctx.font="28px Fredoka One";
    ctx.fillStyle="white";
    ctx.textAlign="center";
    ctx.fillText(totalBoxes+" / "+target, tubeX+tubeWidth/2, tubeY+tubeHeight+40);
}

// ---------------- Main Draw ----------------
function drawDashboard(){
    drawBackground();
    drawSnow();
    drawDepartmentChart();
    drawTube();
    requestAnimationFrame(drawDashboard);
}

// ---------------- Input & Export ----------------
function updateData(){
    departments=document.getElementById("deptInput").value.split(",").map(a=>a.trim());
    boxes=document.getElementById("boxInput").value.split(",").map(a=>Number(a));
    target=Number(document.getElementById("targetInput").value);
}

function exportPNG(){
    const dataURL=canvas.toDataURL("image/png");
    const link=document.createElement('a');
    link.href=dataURL;
    link.download="shoebox-dashboard.png";
    link.click();
}

function exportGIF(){
    const gif=new GIF({workers:2,quality:10,width:canvas.width,height:canvas.height});
    let frames=0;
    const captureFrame=()=>{
        if(frames<50){
            gif.addFrame(canvas,{copy:true,delay:50});
            frames++;
            requestAnimationFrame(captureFrame);
        } else {
            gif.on('finished', blob=>window.open(URL.createObjectURL(blob)));
            gif.render();
        }
    };
    captureFrame();
}

drawDashboard();
</script>
</body>
</html>
